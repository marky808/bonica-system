# Google Sheetsテンプレート構造分析レポート

## 分析実施日時
2025年11月15日

## 分析対象

### 1. 納品書テンプレート
- **URL**: https://docs.google.com/spreadsheets/d/1_zOTChDJsjrKFtNMAKezlFe0N4ZmEz9WV1Ypc4NsVxQ/edit
- **スプレッドシートID**: `1_zOTChDJsjrKFtNMAKezlFe0N4ZmEz9WV1Ypc4NsVxQ`
- **スプレッドシート名**: ボニカ請求書
- **シート名**: 請求書テンプレート

### 2. 請求書テンプレート
- **URL**: https://docs.google.com/spreadsheets/d/1vaxKYp767uQXg9E6EPDcL4QFwZoqLCpZ7AT32GMhrCY/edit
- **スプレッドシートID**: `1vaxKYp767uQXg9E6EPDcL4QFwZoqLCpZ7AT32GMhrCY`
- **スプレッドシート名**: ボニカ納品書
- **シート名**: 納品書テンプレート

⚠️ **注意**: スプレッドシートIDとタイトルが逆になっている可能性があります。
- `1_zOTChDJsjrKFtNMAKezlFe0N4ZmEz9WV1Ypc4NsVxQ` → タイトルは「ボニカ請求書」
- `1vaxKYp767uQXg9E6EPDcL4QFwZoqLCpZ7AT32GMhrCY` → タイトルは「ボニカ納品書」

環境変数の設定と実際のスプレッドシートの対応を確認する必要があります。

---

## 納品書テンプレートの構造分析

### 基本情報
- **スプレッドシートID**: 1_zOTChDJsjrKFtNMAKezlFe0N4ZmEz9WV1Ypc4NsVxQ
- **タイトル**: ボニカ請求書（実際は納品書？）
- **シート名**: 請求書テンプレート
- **行数**: 1000
- **列数**: 26（A〜Z列）
- **セル結合**: 0箇所
- **印刷設定**: 未確認（A4想定）

### ヘッダー部分の構成

#### タイトル「請求書」
- **セル位置**: B2
- **セル結合**: なし
- **背景色**: #FFFFFF（白）
- **フォント**: Calibri, 16pt, 太字
- **文字位置**: 左寄せ
- **プレースホルダー**: なし（固定テキスト）

#### 会社情報
- **会社名**: セルB1
  - 内容: 「ボニカアグリジェント株式会社」
  - フォント: Calibri, 14pt, 太字

### 顧客情報エリア

#### 請求書番号
- **セル位置**: A3
- **ラベル**: 「請求書番号:」
- **フォント**: Calibri, 11pt
- **値のセル**: B3（推定、データなし）

#### 請求日
- **セル位置**: A4
- **ラベル**: 「請求日:」
- **フォント**: Calibri, 11pt
- **値のセル**: B4（推定、データなし）

#### 顧客名
- **セル位置**: A5
- **ラベル**: 「お客様:」
- **フォント**: Calibri, 11pt
- **値のセル**: B5（推定、データなし）

#### 住所
- **セル位置**: A6
- **ラベル**: 「住所:」
- **フォント**: Calibri, 11pt
- **値のセル**: B6（推定、データなし）

### 明細テーブル

#### テーブルタイトル
- **セル位置**: B9
- **内容**: 「請求明細」
- **フォント**: Calibri, 12pt, 太字

#### ヘッダー行（10行目）

| 列 | セル | 項目名 | 幅 | 背景色 | フォント | 配置 |
|---|------|--------|-----|---------|----------|------|
| A | A10 | 商品名 | - | #ffe4b5（薄いオレンジ） | Calibri, 11pt, 太字 | 中央 |
| B | B10 | 数量 | - | #ffe4b5 | Calibri, 11pt, 太字 | 中央 |
| C | C10 | 単価 | - | #ffe4b5 | Calibri, 11pt, 太字 | 中央 |
| D | D10 | 金額 | - | #ffe4b5 | Calibri, 11pt, 太字 | 中央 |

**列数**: 4列のみ（A, B, C, D）

#### データ行
- **開始行**: 11行目（推定）
- **終了行**: 不明（空のテンプレート）
- **罫線**: 未確認
- **データ**: サンプルデータなし

#### 数式
- **確認結果**: 数式は見つかりませんでした
- **推定**: データ投入時にAPIが値を直接書き込んでいる可能性

### フッター部分

#### 合計金額表示
- **セル位置**: C22
- **ラベル**: 「合計」
- **フォント**: Calibri, 11pt, 太字
- **値のセル**: D22（推定）

#### 備考欄
- **セル位置**: A24
- **ラベル**: 「備考:」
- **フォント**: Calibri, 11pt

### その他の設定
- **セルの結合**: 0箇所
- **条件付き書式**: なし
- **データ検証**: なし
- **名前付き範囲**: 未確認
- **保護範囲**: 未確認

---

## 請求書テンプレートの構造分析

### 基本情報
- **スプレッドシートID**: 1vaxKYp767uQXg9E6EPDcL4QFwZoqLCpZ7AT32GMhrCY
- **タイトル**: ボニカ納品書（実際は請求書？）
- **シート名**: 納品書テンプレート
- **行数**: 1000
- **列数**: 26（A〜Z列）
- **セル結合**: 0箇所
- **印刷設定**: 未確認（A4想定）

### ヘッダー部分の構成

#### タイトル「納品書」
- **セル位置**: B2
- **セル結合**: なし
- **背景色**: #FFFFFF（白）
- **フォント**: Calibri, 16pt, 太字
- **文字位置**: 左寄せ
- **プレースホルダー**: なし（固定テキスト）

#### 会社情報
- **会社名**: セルB1
  - 内容: 「株式会社ボニカアグリジェント」
  - フォント: Calibri, 14pt, 太字

### 顧客情報エリア

#### 納品書番号
- **セル位置**: A3
- **ラベル**: 「納品書番号:」
- **フォント**: Calibri, 11pt
- **値のセル**: B3（推定、データなし）

#### 納品日
- **セル位置**: A4
- **ラベル**: 「納品日:」
- **フォント**: Calibri, 11pt
- **値のセル**: B4（推定、データなし）

#### 顧客名
- **セル位置**: A5
- **ラベル**: 「お客様:」
- **フォント**: Calibri, 11pt
- **値のセル**: B5（推定、データなし）

#### 住所
- **セル位置**: A6
- **ラベル**: 「住所:」
- **フォント**: Calibri, 11pt
- **値のセル**: B6（推定、データなし）

### 明細テーブル

#### テーブルタイトル
- **セル位置**: B9
- **内容**: 「商品明細」
- **フォント**: Calibri, 12pt, 太字

#### ヘッダー行（10行目）

| 列 | セル | 項目名 | 幅 | 背景色 | フォント | 配置 |
|---|------|--------|-----|---------|----------|------|
| A | A10 | 商品名 | - | #e6e6fa（薄い紫） | Calibri, 11pt, 太字 | 中央 |
| B | B10 | 数量 | - | #e6e6fa | Calibri, 11pt, 太字 | 中央 |
| C | C10 | 単価 | - | #e6e6fa | Calibri, 11pt, 太字 | 中央 |
| D | D10 | 金額 | - | #e6e6fa | Calibri, 11pt, 太字 | 中央 |

**列数**: 4列のみ（A, B, C, D）

#### データ行
- **開始行**: 11行目（推定）
- **終了行**: 不明（空のテンプレート）
- **罫線**: 未確認
- **データ**: サンプルデータなし

#### 数式
- **確認結果**: 数式は見つかりませんでした
- **推定**: データ投入時にAPIが値を直接書き込んでいる可能性

### フッター部分

#### 合計金額表示
- **セル位置**: C22
- **ラベル**: 「合計」
- **フォント**: Calibri, 11pt, 太字
- **値のセル**: D22（推定）

#### 備考欄
- **セル位置**: A24
- **ラベル**: 「備考:」
- **フォント**: Calibri, 11pt

### その他の設定
- **セルの結合**: 0箇所
- **条件付き書式**: なし
- **データ検証**: なし
- **名前付き範囲**: 未確認
- **保護範囲**: 未確認

---

## 納品書と請求書の違い

| 項目 | 納品書テンプレート | 請求書テンプレート | 備考 |
|------|-------------------|-------------------|------|
| タイトル文言 | 「請求書」（B2） | 「納品書」（B2） | 逆？ |
| 会社名 | 「ボニカアグリジェント株式会社」 | 「株式会社ボニカアグリジェント」 | 順序が違う |
| タイトルセル位置 | B2 | B2 | 同じ |
| 背景色（タイトル） | #FFFFFF（白） | #FFFFFF（白） | 同じ |
| 顧客名セル | A5 | A5 | 同じ |
| 番号セル | A3（請求書番号） | A3（納品書番号） | 同じ位置 |
| 日付セル | A4（請求日） | A4（納品日） | 同じ位置 |
| 明細開始行 | 10行目 | 10行目 | 同じ |
| 明細列構成 | A=商品名, B=数量, C=単価, D=金額 | A=商品名, B=数量, C=単価, D=金額 | **完全に同じ（4列のみ）** |
| ヘッダー背景色 | #ffe4b5（薄いオレンジ） | #e6e6fa（薄い紫） | **違う（色分け）** |
| フッター内容 | 合計（C22）、備考（A24） | 合計（C22）、備考（A24） | 同じ |
| 数式の有無 | なし | なし | **両方ともなし** |

### 主な違いのまとめ
1. **ヘッダー背景色のみが違う**（オレンジ vs 紫）
2. **会社名の表記が微妙に違う**（語順）
3. **構造はほぼ同一**
4. **いずれも非常にシンプルな4列構成**

---

## 重大な発見：環境変数の設定ミス

`.env.local`の設定を確認したところ、以下のように**逆に設定されている可能性**があります：

```env
GOOGLE_SHEETS_DELIVERY_TEMPLATE_SHEET_ID="1vaxKYp767uQXg9E6EPDcL4QFwZoqLCpZ7AT32GMhrCY"
GOOGLE_SHEETS_INVOICE_TEMPLATE_SHEET_ID="1_zOTChDJsjrKFtNMAKezlFe0N4ZmEz9WV1Ypc4NsVxQ"
```

しかし、実際のスプレッドシートは：
- `1_zOTChDJsjrKFtNMAKezlFe0N4ZmEz9WV1Ypc4NsVxQ` → 「ボニカ請求書」
- `1vaxKYp767uQXg9E6EPDcL4QFwZoqLCpZ7AT32GMhrCY` → 「ボニカ納品書」

**推奨対応**: 環境変数の設定を確認し、必要に応じて修正する。

---

## 次のステップ

このテンプレートはPDFサンプルとは**大きく異なる**ため、次の分析が必要です：

1. ✅ 既存テンプレートの構造把握（完了）
2. 🔄 PDFデザインの詳細分析（次）
3. 🔄 両者の比較と差分の洗い出し
4. 🔄 改善計画の策定

**PDFデザイン分析**を次に実施します。

---

## PDFサンプルデザインの詳細分析

### PDFの概要情報

#### ドキュメント情報
- **種類**: 請求書
- **請求書番号**: S000000330
- **請求年月**: 2025/09
- **顧客**: ムスビガーデン都立大学店 御中
- **合計金額**: 62,416円

#### 会社情報（右上ブロック）
- **法人番号**: T9030001039654
- **会社名**: 株式会社 ボニカ・アグリジェント
- **郵便番号**: 〒341-0035
- **住所**: 埼玉県三郷市鷹野4-441
- **電話**: 048-954-6891
- **FAX**: 048-954-6892

### レイアウト設計

#### ヘッダー部分

##### タイトル「請求書」
- **位置**: 左上
- **背景色**: #00A0E9（青色）
- **文字色**: 白
- **配置**: 青い背景バー全体にタイトル
- **推定セル結合**: 横方向に複数セル結合（A1:I1など）

##### 顧客情報（左側）
- **顧客名**: タイトルの下、左側に配置
- **表示**: 「ムスビガーデン都立大学店 御中」

##### 請求情報（右上）
- **請求番号**: 「請求No.S000000330」
- **請求年月**: 「2025/09」
- **配置**: タイトルと同じ高さまたはその下

##### 会社情報（右上ブロック）
- **法人番号**: 「T9030001039654」（インボイス制度対応）
- **会社名**: 「株式会社 ボニカ・アグリジェント」
- **住所**: 複数行で表示
  - 郵便番号: 〒341-0035
  - 住所: 埼玉県三郷市鷹野4-441
- **連絡先**:
  - TEL: 048-954-6891
  - FAX: 048-954-6892

##### 請求金額の表示（大きく表示）
- **ラベル**: 「今回ご請求額」
- **金額**: 62,416円
- **スタイル**: 大きなフォントで目立つように表示

### 明細テーブル（中央部分）

#### テーブル構成：9列

| 列番号 | 列名 | 幅の目安 | データ型 | 備考 |
|--------|------|----------|----------|------|
| 1 | 日付 | 狭い | 日付（MM/DD(曜日)） | 例: 08/22(金) |
| 2 | 品名 | 広い | テキスト | 商品名 + 産地など詳細情報 |
| 3 | 単価 | 中 | 数値 | 円 |
| 4 | 数量 | 狭い | 数値（小数点2桁） | 例: 5.00 |
| 5 | 単位 | 狭い | テキスト | kg, 袋, 箱など |
| 6 | 税率 | 狭い | テキスト | 8%, 10% |
| 7 | 税抜金額 | 中 | 数値（計算） | 単価 × 数量 |
| 8 | 消費税 | 中 | 数値（計算） | 税抜金額 × 税率 |
| 9 | 備考 | 中 | テキスト | 冷蔵など特記事項 |

#### ヘッダー行のスタイル
- **背景色**: 濃いグレーまたは青系（#00A0E9に近い色）
- **文字色**: 白
- **フォント**: 太字
- **配置**: 中央揃え

#### データ行のサンプル（PDFより）

**1行目**:
```
日付: 08/22(金)
品名: 広石農園バレンシアオレンジ /神奈川県
単価: 350
数量: 5.00
単位: kg
税率: 8%
税抜金額: 1750
消費税: 140
備考: （空）
```

**4行目（送料の例）**:
```
日付: 08/22(金)
品名: 送料 ヤマト運輸 /
単価: 1800
数量: 1.00
単位: 箱
税率: 10%
税抜金額: 1800
消費税: 180
備考: 冷蔵
```

**全明細データ**: 6品目（PDFサンプル1ページ目）

#### 罫線スタイル
- ヘッダー行: 上下に太い罫線
- データ行: 薄い罫線（行ごと）
- 最終行: 下に太い罫線

#### 計算式（推定）

##### 税抜金額の計算
```
税抜金額 = 単価 × 数量
```

##### 消費税の計算
```
消費税 = 税抜金額 × (税率 / 100)
```
- 端数処理: 四捨五入または切り捨て（要確認）

### フッター部分

#### 振込先情報ブロック（左下）
- **金融機関名**: 朝日信用金庫
- **支店名**: 三郷支店
- **口座種別**: 普通
- **口座番号**: 0430910
- **口座名義**: カ)ボニカ・アグリジェント

#### 税額集計ブロック（右下）

| 項目 | 金額 |
|------|------|
| 10%対象額 | 13,650円 |
| 10%消費税額 | 1,365円 |
| 8%対象額 | 43,890円 |
| 8%消費税額 | 3,511円 |
| **合計金額** | **62,416円** |
| **合計税額** | **4,876円** |

#### レイアウト
- **配置**: 2段組
  - 左側: 振込先情報
  - 右側: 税額集計
- **境界線**: テーブル形式で罫線あり

### デザインの特徴

1. **青い背景のヘッダー**: 目を引く青色（#00A0E9）で「請求書」を強調
2. **9列の詳細な明細**: 日付、税率、税額を含む詳細な情報
3. **税率別集計**: 8%と10%の混在に対応した集計表
4. **インボイス制度対応**: 法人番号（T番号）の明記
5. **2段組フッター**: 振込先と税額集計を左右に配置

---

## PDFデザインと既存テンプレートの比較

### 重大な差異

#### 1. 列数の違い

| 項目 | PDFデザイン | 既存テンプレート | 差分 |
|------|------------|-----------------|------|
| 列数 | **9列** | **4列** | **+5列** |
| 列構成 | 日付、品名、単価、数量、単位、税率、税抜金額、消費税、備考 | 商品名、数量、単価、金額 | - |

**必要な追加列**:
1. 日付
2. 単位
3. 税率
4. 税抜金額（金額を分割）
5. 消費税
6. 備考

#### 2. ビジュアルデザインの違い

| 要素 | PDFデザイン | 既存テンプレート | 変更の必要性 |
|------|------------|-----------------|-------------|
| タイトル背景色 | #00A0E9（青） | #FFFFFF（白） | **要変更** |
| タイトル文字色 | 白 | 黒 | **要変更** |
| ヘッダー背景色 | 青系または濃いグレー | #ffe4b5（薄いオレンジ） | **要変更** |
| セル結合 | タイトル行で複数セル結合 | なし | **要追加** |

#### 3. フッター構成の違い

| 項目 | PDFデザイン | 既存テンプレート | 変更の必要性 |
|------|------------|-----------------|-------------|
| 振込先情報 | あり（左下ブロック） | **なし** | **要追加** |
| 税率別集計 | あり（8%/10%別） | **なし** | **要追加** |
| 合計金額のみ | - | あり（C22） | 削除または移動 |

#### 4. 会社情報の違い

| 項目 | PDFデザイン | 既存テンプレート | 変更の必要性 |
|------|------------|-----------------|-------------|
| 法人番号 | あり（T9030001039654） | **なし** | **要追加** |
| 住所 | 詳細表示 | **なし** | **要追加** |
| 電話/FAX | 表示 | **なし** | **要追加** |
| 配置 | 右上ブロック | 左上（B1） | 再配置 |

### データ項目の対応表

| PDFの列 | 項目名 | 既存テンプレート | 対応状況 | 備考 |
|---------|--------|-----------------|----------|------|
| 1列目 | 日付 | **なし** | ❌ 未対応 | 新規追加が必要 |
| 2列目 | 品名 | A列（商品名） | ✅ 対応 | 名称が違うが同じ |
| 3列目 | 単価 | C列（単価） | ✅ 対応 | 順序が違う |
| 4列目 | 数量 | B列（数量） | ✅ 対応 | 順序が違う |
| 5列目 | 単位 | **なし** | ❌ 未対応 | 新規追加が必要 |
| 6列目 | 税率 | **なし** | ❌ 未対応 | 新規追加が必要 |
| 7列目 | 税抜金額 | D列（金額） | ⚠️ 部分対応 | 税込→税抜に変更 |
| 8列目 | 消費税 | **なし** | ❌ 未対応 | 新規追加が必要 |
| 9列目 | 備考 | **なし** | ❌ 未対応 | 新規追加が必要 |

### 数式の必要性

#### 既存テンプレート
- **数式なし**: 全て値の直接書き込み

#### PDFデザイン（推奨）
以下の数式が必要：

1. **税抜金額（G列）**: `=C * D`（単価 × 数量）
2. **消費税（H列）**: `=G * (F / 100)`（税抜金額 × 税率）
3. **10%対象額**: `=SUMIF(F:F, "10%", G:G)`（税率10%の税抜金額合計）
4. **10%消費税**: `=SUMIF(F:F, "10%", H:H)`（税率10%の消費税合計）
5. **8%対象額**: `=SUMIF(F:F, "8%", G:G)`（税率8%の税抜金額合計）
6. **8%消費税**: `=SUMIF(F:F, "8%", H:H)`（税率8%の消費税合計）
7. **合計金額**: `=SUM(G:G) + SUM(H:H)`（税抜合計 + 税額合計）
8. **合計税額**: `=SUM(H:H)`（消費税の合計）

---

## 項目の過不足まとめ

### PDFにあって、既存テンプレートにない項目

#### 必須項目
1. **日付列**（1列目）
2. **単位列**（5列目）
3. **税率列**（6列目）
4. **消費税列**（8列目）
5. **備考列**（9列目）

#### ヘッダー・フッター要素
6. **法人番号（T番号）**
7. **会社住所（郵便番号含む）**
8. **電話番号・FAX番号**
9. **振込先情報ブロック**
   - 金融機関名
   - 支店名
   - 口座種別
   - 口座番号
   - 口座名義
10. **税率別集計ブロック**
   - 10%対象額
   - 10%消費税額
   - 8%対象額
   - 8%消費税額
   - 合計金額
   - 合計税額

#### デザイン要素
11. **青い背景のタイトルバー**
12. **セル結合（タイトル行）**
13. **ヘッダー行の背景色変更**

### 既存テンプレートにあって、PDFにない項目

1. **特になし**

現在の既存テンプレートは非常にシンプルで、PDFに存在しない独自項目はありません。

---

## 計算式の検証（PDFサンプルデータで確認）

### サンプル1: 広石農園バレンシアオレンジ

**入力値**:
- 単価: 350円
- 数量: 5.00 kg
- 税率: 8%

**計算**:
- 税抜金額 = 350 × 5.00 = **1,750円** ✅
- 消費税 = 1,750 × 0.08 = **140円** ✅

### サンプル2: 送料 ヤマト運輸

**入力値**:
- 単価: 1,800円
- 数量: 1.00 箱
- 税率: 10%

**計算**:
- 税抜金額 = 1,800 × 1.00 = **1,800円** ✅
- 消費税 = 1,800 × 0.10 = **180円** ✅

### 合計の検証

**PDFサンプルの集計**:
- 10%対象額: 13,650円
- 10%消費税: 1,365円
- 8%対象額: 43,890円
- 8%消費税: 3,511円
- **合計金額**: 62,416円
- **合計税額**: 4,876円

**検算**:
- 10%対象額 + 8%対象額 + 合計税額 = 13,650 + 43,890 + 4,876 = **62,416円** ✅
- 10%消費税 + 8%消費税 = 1,365 + 3,511 = **4,876円** ✅

**結論**: 計算式は正しい。端数処理は四捨五入または切り捨てと推定。

---

## 結論

### 現状の問題点

1. **構造が全く異なる**: 4列 vs 9列
2. **デザインが全く異なる**: 白背景 vs 青背景
3. **機能が不足**: 税率別集計、振込先情報がない
4. **数式がない**: 全て値の直接書き込み

### 改善の必要性

**規模**: 大規模な改修が必要

このテンプレートをPDFデザインに合わせるには、以下が必要です：

1. ✅ 列の追加（+5列）
2. ✅ デザインの大幅変更
3. ✅ フッターブロックの追加
4. ✅ 数式の実装
5. ✅ システム連携コードの変更

**推奨アプローチ**:
- 既存テンプレートを修正するのではなく、**新しいテンプレートを作成**する方が効率的
- または、段階的に移行する

次のステップとして、**具体的な改善計画（IMPROVEMENT_PLAN.md）**を策定します。
